<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

    <script
            src="https://code.jquery.com/jquery-3.3.1.min.js"
            integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
            crossorigin="anonymous"></script>

</head>
<body>
number of players: <span id="players"></span>

<script src="/socket.io/socket.io.js"></script>
<script src="/js/howler.js"></script>
<script>
    var notes = {};

    preloadHowler();

    var socket = io();

    socket.on('connect', function() {
        socket.on('connectionsChanged', function(data) {
            console.log(data);
            $("#players").html(data.connections);
        });
    });

    $(document).keydown(function(keyPressed) {
        switch (keyPressed.keyCode) {
            case 90:
                activateHowl('lower_do');
                socket.emit('keyPressed', {key: 'lower_do'});
                break;
            case 88:
                activateHowl('re');
                socket.emit('keyPressed', {key: 're'});
                break;
            case 67:
                activateHowl('mi');
                socket.emit('keyPressed', {key: 'mi'});
                break;
            case 86:
                activateHowl('fa');
                socket.emit('keyPressed', {key: 'fa'});
                break;
            case 66:
                activateHowl('sol');
                socket.emit('keyPressed', {key: 'sol'});
                break;
            case 78:
                activateHowl('la');
                socket.emit('keyPressed', {key: 'la'});
                break;
            case 77:
                activateHowl('si');
                socket.emit('keyPressed', {key: 'si'});
                break;
            case 188:
                activateHowl('higher_do');
                socket.emit('keyPressed', {key: 'higher_do'});
                break;
            default:
                //nothing
        }
    });

    socket.on('pressKey', function (key) {
        switch (key) {
            case 'lower_do':
                activateHowl('lower_do');
                break;
            case 're':
                activateHowl('re');
                break;
            case 'mi':
                activateHowl('mi');
                break;
            case 'fa':
                activateHowl('fa');
                break;
            case 'sol':
                activateHowl('sol');
                break;
            case 'la':
                activateHowl('la');
                break;
            case 'si':
                activateHowl('si');
                break;
            case 'higher_do':
                activateHowl('higher_do');
                break;
        }
    });

    function preloadHowler() {
        var lower_do = new Howl({
            src: [`piano/lower_do.wav`],
            preload: true
        });
        var re = new Howl({
            src: [`piano/re.wav`],
            preload: true
        });
        var mi = new Howl({
            src: [`piano/mi.wav`],
            preload: true
        });
        var fa = new Howl({
            src: [`piano/fa.wav`],
            preload: true
        });
        var sol = new Howl({
            src: [`piano/sol.wav`],
            preload: true
        });
        var la = new Howl({
            src: [`piano/la.wav`],
            preload: true
        });
        var si = new Howl({
            src: [`piano/si.mp3`],
            volume: 0.2,
            preload: true
        });
        var higher_do = new Howl({
            src: [`piano/higher_do.wav`],
            preload: true
        });

        notes = {
            lower_do,
            re,
            mi,
            fa,
            sol,
            la,
            si,
            higher_do
        };
    }

    function activateHowl(key) {
        notes[key].play();
    }
</script>
</body>
</html>